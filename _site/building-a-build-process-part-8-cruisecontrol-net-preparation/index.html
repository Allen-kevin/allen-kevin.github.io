<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Building a Build Process, Part 8: CruiseControl.NET Preparation &#8211; Site Title</title>
<meta name="description" content="This is part of a larger series in building a proper build process. For more information and additional series links, check out the introductory post.

">
<meta name="keywords" content="">



<!-- Twitter Cards -->
<meta name="twitter:title" content="Building a Build Process, Part 8: CruiseControl.NET Preparation">
<meta name="twitter:description" content="This is part of a larger series in building a proper build process. For more information and additional series links, check out the introductory post.

">



<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://localhost:4000/images/default-thumb.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Building a Build Process, Part 8: CruiseControl.NET Preparation">
<meta property="og:description" content="This is part of a larger series in building a proper build process. For more information and additional series links, check out the introductory post.

">
<meta property="og:url" content="http://localhost:4000/building-a-build-process-part-8-cruisecontrol-net-preparation/">
<meta property="og:site_name" content="Site Title">





<link rel="canonical" href="http://localhost:4000/building-a-build-process-part-8-cruisecontrol-net-preparation/">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Site Title Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="http://localhost:4000/assets/js/vendor/html5shiv.min.js"></script>
	<script src="http://localhost:4000/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://localhost:4000/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="http://localhost:4000">Site Title</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
					    
					        
					    
					    <li><a href="http://localhost:4000/about/" >About</a></li>
					  
					    
					        
					    
					    <li><a href="http://localhost:4000/posts/" >Sample Posts</a></li>
					  
					    
					        
					    
					    <li><a href="http://localhost:4000/theme-setup/" >Theme Setup</a></li>
					  
					    
					        
					        
					    <li><a href="http://mademistakes.com" target="_blank">Made Mistakes</a></li>
					  
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    



	<img src="http://localhost:4000/images/bio-photo.jpg" class="bio-photo" alt="Your Name bio photo">

<h3>Your Name</h3>
<p>Describe your self.</p>















  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="http://localhost:4000/building-a-build-process-part-8-cruisecontrol-net-preparation/" rel="bookmark" title="Building a Build Process, Part 8: CruiseControl.NET Preparation">Building a Build Process, Part 8: CruiseControl.NET Preparation</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p><em>This is part of <a href="">a larger series</a> in building a proper build process. For more information and additional series links, check out the <a href="">introductory post</a>.</em></p>

<h3 id="choosing-whether-to-run-as-network-service-or-another-user">Choosing Whether to Run as Network Service or another user</h3>
<p>This was brought up as an excellent point by Bahrep on a recent blog post of mine, and I thought it was worth sharing for this series. </p>

<p>Essentially, the issue is that CruiseControl.NET runs under the network service user (which makes sense), but in order to accept an SVN certificate, you need to be logged in as that user and check out a copy of the repository once to accept the certificate before CruiseControl will be able to connect to the repository as itself.</p>

<p>There are two ways you can go about this. The more visible way is to create a local user account on the server (i.e. “CI”) which you then tell CruiseControl to run as. You give CI the permissions it needs, including signing on to that user account once , checking out the repository, and accepting the certificate.</p>

<p>The second option is to download and install PsExec, which lets you run programs under other user accounts. You then use PsExec to run the checkout command as the network service user and accept the certificate. No extra user account, no changing how the service runs. It’s a simpler solution, but a much less visible change that you’ll want to document. </p>

<p>Directions for both options are shown below. For what it’s worth, <strong>I now prefer option 2.</strong></p>

<h3 id="option-1-part-1-creating-a-local-user-for-ci-purposes">Option 1 Part 1: Creating a Local User for CI Purposes</h3>
<ul>
  <li>Click start and type <code>compmgmt.msc</code> to bring up Computer Management.  </li>
  <li>In the left-hand navigation, choose <code>Local Users and Groups &gt;Users</code>  </li>
  <li>Right-click and select <code>New User…</code>  </li>
  <li>Name the user <code>CI</code> or something related to the purpose at hand.  </li>
  <li>Give the user a password.  </li>
  <li>Uncheck <code>User must change password</code></li>
  <li>Check <code>password never expires</code>.  </li>
  <li>Create the User account.  </li>
  <li>Right-click the new account and select Properties.  </li>
  <li>Click the <code>Member Of</code> tab.  </li>
  <li>Add the user to the <code>Administrators</code> Group. <strong>NOTE:</strong> This is <strong>not</strong> ideal for the purposes of production. Normally, you’d want to ensure this user account only has access to what it needs for CC.NET (this is why I’m leaning towards option 2).  </li>
  <li>Now is also a good time to install TortoiseSVN on the build server, if you haven’t yet. (be sure to install the command-line client tools as well!)</li>
</ul>

<h4 id="option-1-part-2-accepting-the-svn-certificate-as-the-ci-user">Option 1 Part 2: Accepting the SVN Certificate as the CI User</h4>
<ul>
  <li>Log off the Administrator account and sign in as your new CI account.  </li>
  <li>Run the command prompt  </li>
  <li>
    <p>Run <code>svn info</code> to accept the certificate. This can be done by running: </p>

    <pre><code>  svn info https://[repo URL or hostname]svn/TestProjectRepo –username svnuser1 –password passw0rd1
</code></pre>
  </li>
  <li>Type <code>p</code> to accept the certificate permanently, and you’re all set!</li>
</ul>

<h4 id="option-1-part-3-run-the-cruisecontrolnet-service-as-the-ci-user">Option 1 Part 3: Run the CruiseControl.NET Service as the CI User</h4>
<ul>
  <li>Log off the CI account and back into the Administrator account.  </li>
  <li>Run <code>services.msc</code>  </li>
  <li>Right-click the <code>CruiseControl.net</code> service and choose <code>Properties</code>  </li>
  <li>Click the <code>Log On</code> tab.  </li>
  <li>Click the <code>This account</code> radio button.  </li>
  <li>Click Browse and Type CI. THe resulting username entry will be <code>.CI</code></li>
  <li>Enter the password you created for the CI account and click apply.  </li>
  <li>You will see a message that it has been granted the “Log On as a Service” Right.</li>
</ul>

<h3 id="option-2-using-psexec-to-accept-the-svn-cert-as-the-network-service-user">Option 2: Using PsExec to Accept the SVN Cert as the Network Service User</h3>
<p><strong>NOTE</strong>: At points during this process, you may receive a warning from your antivirus program. This is because PsExec can be dangerous when misused, and viruses have used it in attacks in the past. We know our usage is legitimate here, so we can unblock/ok PsExec operations when we’re working with it.</p>

<ul>
  <li>Visit the PsExec Website and Download the application (actually will be a zip file of all the PSExec tools)  </li>
  <li>Unzip the PsExec zip file  </li>
  <li>open a command prompt and navigate to the folder of PsTools  </li>
  <li>Run <code>psexec -u "nt authoritynetwork service" cmd.exe.</code> This will run the command prompt as the network service user.  </li>
  <li>
    <p>Run svn info to accept the certificate. This can be done by running:</p>

    <pre><code>  svn info https://[svn ip or hostname]/svn/TestProjectRepo –username svnuser1 –password passw0rd1
</code></pre>
  </li>
  <li>Type <code>p</code> to accept the certificate permanently, and you’re all set!</li>
</ul>

<h3 id="add-a-ci-user-to-the-repository">Add a CI User to the Repository</h3>
<ul>
  <li>Open your CentOS source code management VM</li>
  <li>
    <p>Taking advice from our <a href="http://skwordpresstoghost.azurewebsites.net/?p=631">Subversion &amp; Apache article</a>, we’ll run the following command to add a new CI user without deleting the old ones: </p>

    <pre><code>  htpasswd -sb /var/www/svn/auth/svn.htpasswd ci passw0rdci
</code></pre>
  </li>
</ul>

<p>Now you’re set to allow CruiseControl to pull down files under its own again (just around the bend in this series when we configure CCNet).</p>

<h3 id="copying-the-microsoft-targets-to-the-build-server">Copying the Microsoft Targets to the Build Server</h3>
<p>When dealing with this elsewhere, <a href="http://skwordpresstoghost.azurewebsites.net/?p=531">I discovered this problem</a>. We’ll avoid it in advance here.</p>

<ul>
  <li>You have to copy the two files from your local development machine (with VS installed) to the Build Server.</li>
  <li>Copy the directory <code>C:\Program Files (x86)\MSBuild\Microsoft\VisualStudio\*.*</code> to the same location on the build server.</li>
</ul>

<h3 id="copying-the-reference-assemblies-to-the-build-server">Copying the Reference Assemblies to the Build Server</h3>
<p>When dealing with this elsewhere, <a href="http://skwordpresstoghost.azurewebsites.net/?p=521">I discovered this problem</a>. We’ll avoid it in advance here.</p>

<ul>
  <li>On your local development machine, copy <code>C:\Program Files (x86)\Reference Assemblies\Microsoft\Framework\.NETFramework\*.*</code> to a folder on your build server. For me, it was <code>E:\ContinuousIntegration_ReferenceAssemblies</code> so that it could keep it common for any future builds.</li>
</ul>

<p>In the next part in the series, we’ll finally configure CruiseControl.NET and get it to build. Thanks for hanging out with me on this epic journey towards build awesomeness!</p>

<h3 id="feedback-welcome">Feedback Welcome!</h3>
<p>I’d love to hear any comments on this series. Find it useful? Think there’s a better way to implement the technique or something I should have mentioned? Please drop a line in the comments to help me improve the series!</p>

<h3 id="references">References</h3>
<ul>
  <li><a href="http://technet.microsoft.com/en-us/sysinternals/bb897553">PsExec Website</a> </li>
</ul>

<table>
<tr>
<td><div align="left"><a href="http://skwordpresstoghost.azurewebsites.net/?p=501">&larr; Part 7: Installing CruiseControl.NET</a></div></td>
<td><div align="right">Part 9: coming soon! &rarr; </div></td>
</tr>
</table>


      <hr />
      <footer role="contentinfo">
        <div class="article-author-bottom">
          



	<img src="http://localhost:4000/images/bio-photo.jpg" class="bio-photo" alt="Your Name bio photo">

<h3>Your Name</h3>
<p>Describe your self.</p>















        </div>
        <p class="byline"><strong>Building a Build Process, Part 8: CruiseControl.NET Preparation</strong> was published on <time datetime="2012-05-03T13:36:00-04:00">May 03, 2012</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="http://localhost:4000/posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="http://localhost:4000/how-to-drag-and-drop-files-to-an-elevated-program-field-notes/" title="How to: Drag and Drop Files to an Elevated Program [Field Notes]">How to: Drag and Drop Files to an Elevated Program [Field Notes]</a></li>
    
      <li><a href="http://localhost:4000/quick-tip-file-hashes-with-powershell-community-extensions/" title="Quick Tip: File Hashes with PowerShell Community Extensions">Quick Tip: File Hashes with PowerShell Community Extensions</a></li>
    
      <li><a href="http://localhost:4000/web-site-fail-of-the-day-intel-rst-community-forum/" title="Web site fail of the day: Intel RST Community Forum">Web site fail of the day: Intel RST Community Forum</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  <footer>
    

<span>&copy; 2014 Your Name. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/minimal-mistakes/">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://localhost:4000/assets/js/scripts.min.js"></script>

	        

</body>
</html>